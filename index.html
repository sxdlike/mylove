<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‰Ω†ÁöÑÂ§™Èò≥ÊàëÁöÑÂøÉ~</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: "STKaiti", serif;
        overflow: hidden;
        background: #000;
    }
    #photoFlow {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 0;
    }
    .photo {
        position: absolute;
        width: 100px;
        height: 70px;
        object-fit: cover;
        border-radius: 6px;
        box-shadow: 0 0 5px rgba(255,255,255,0.3);
        opacity: 0;
        animation: floatUpDown 6s ease-in-out infinite, fadeIn 1.5s forwards;
    }
    @keyframes floatUpDown {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-15px); }
    }
    @keyframes fadeIn {
        to { opacity: 0.9; }
    }
    #child {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
        font-size: clamp(30px, 5vw, 48px);
        color: #f584b7;
        text-shadow: 0 0 15px rgba(255,255,255,0.8), 0 0 25px rgba(255,192,203,0.8);
        opacity: 0;
        transition: opacity 2s ease;
        animation: heartbeatTitle 1.5s infinite;
        text-align: center;
        word-break: break-word;
    }
    @keyframes heartbeatTitle {
        0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.85; }
    }
    canvas {
        position: fixed;
        top: 0; left: 0;
        z-index: 1;
        pointer-events: none;
    }
    .floatingText {
        position: absolute;
        font-size: 32px;
        font-weight: bold;
        pointer-events: none;
        user-select: none;
        z-index: 2;
        opacity: 1;
    }
    .floatingText .cn {
        font-family: "KaiTi","STKaiti",serif;
        color: #ffb6c1;
        text-shadow: 0 0 8px #fff, 0 0 15px #ffb6c1;
    }
    .floatingText .en {
        font-family: "Pacifico", cursive;
        color: #ffd1dc;
        text-shadow: 0 0 8px #fff, 0 0 15px #ffd1dc;
    }
    #playBtn {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        animation: heartbeatBtn 1.2s infinite ease-in-out, rotateFloat 6s infinite linear;
        z-index: 999;
    }
    #playBtn span {
        font-size: 100px;
        color: #ff4d6d;
        text-shadow: 0 0 20px rgba(255,77,109,0.8);
        animation: glow 1s infinite alternate;
    }
    @keyframes heartbeatBtn {
        0%, 100% { transform: translate(-50%, -50%) scale(1);}
        50% { transform: translate(-50%, -50%) scale(1.2);}
    }
    @keyframes glow {
        from { opacity: 0.7; }
        to { opacity: 1; }
    }
    @keyframes rotateFloat {
        0% { transform: translate(-50%, -50%) rotate(0deg) translateY(0px); }
        25% { transform: translate(-50%, -50%) rotate(3deg) translateY(-5px); }
        50% { transform: translate(-50%, -50%) rotate(0deg) translateY(0px); }
        75% { transform: translate(-50%, -50%) rotate(-3deg) translateY(5px); }
        100% { transform: translate(-50%, -50%) rotate(0deg) translateY(0px); }
    }
    #playBtn.fadeOut {
        animation: fadeAway 0.8s forwards;
    }
    @keyframes fadeAway {
        to { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    }

    /* üì± ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 768px) {
        .photo {
            width: 18vw;
            height: auto;
        }
        .floatingText {
            font-size: 6vw;
        }
        #child {
            font-size: clamp(24px, 6vw, 40px);
        }
        #playBtn span {
            font-size: 18vw;
        }
    }
    @media (max-width: 480px) {
        .photo {
            width: 24vw;
            height: auto;
        }
        .floatingText {
            font-size: 7vw;
        }
        #child {
            font-size: clamp(20px, 7vw, 36px);
        }
        #playBtn span {
            font-size: 22vw;
        }
    }
</style>
</head>
<body>

<div id="photoFlow"></div>
<div id="child">üíó‰∏ú‰∏ú‰∏éÁõºÁõºüíó</div>
<canvas id="heart"></canvas>
<div id="playBtn"><span>‚ù§Ô∏è</span></div>

<audio id="music" preload="auto" loop>
    <source src="images/Â¶Ç‰∏Ä.mp3" type="audio/mpeg">
</audio>

<script>
(() => {
    const CONFIG = {
        totalPhotos: 60,
        heartScale: window.innerWidth < 768
            ? { x: 150, y: 10 }
            : { x: 270, y: 18 },
        floatingTextInterval: 500,
        particleLayers: [
            { sx: 210, sy: 13 },
            { sx: 150, sy: 9 },
            { sx: 90, sy: 5 }
        ]
    };

    const photoFlow = document.getElementById('photoFlow');
    const title = document.getElementById("child");
    const canvas = document.getElementById('heart');
    const ctx = canvas.getContext('2d');
    const playBtn = document.getElementById('playBtn');
    const music = document.getElementById('music');

    const loadingDiv = document.createElement("div");
    loadingDiv.style.position = "fixed";
    loadingDiv.style.left = "50%";
    loadingDiv.style.top = "65%";
    loadingDiv.style.transform = "translate(-50%, -50%)";
    loadingDiv.style.color = "#ffb6c1";
    loadingDiv.style.fontSize = window.innerWidth < 768 ? "5vw" : "clamp(20px, 4vw, 36px)";
    loadingDiv.style.fontFamily = "'KaiTi','STKaiti',serif";
    loadingDiv.style.textShadow = "0 0 15px rgba(255,255,255,0.7)";
    loadingDiv.style.zIndex = 9999;
    loadingDiv.innerHTML = "üíñËÆ∞ÂøÜÊ≠£Âú®Âä†ËΩΩ‰∏≠...";
    loadingDiv.style.display = "none";
    document.body.appendChild(loadingDiv);

    let photos = [];
    const rand = Math.random;
    const heartPosition = rad => [
        Math.pow(Math.sin(rad), 3),
        -(15 * Math.cos(rad) - 5 * Math.cos(2 * rad) - 2 * Math.cos(3 * rad) - Math.cos(4 * rad))
    ];
    const scaleAndTranslate = (pos, sx, sy, dx, dy) => [dx + pos[0] * sx, dy + pos[1] * sy];

    function preloadAllPhotos(total, onComplete) {
        let loadedCount = 0;
        loadingDiv.style.display = "block";
        for (let i = 1; i <= total; i++) {
            const src = `images/${String(i).padStart(2, '0')}.jpg`;
            const img = new Image();
            img.src = src;
            img.onload = () => {
                photos.push(img);
                loadedCount++;
                loadingDiv.innerHTML = `üíñËÆ∞ÂøÜÊ≠£Âú®Âä†ËΩΩ‰∏≠... (${loadedCount}/${total})`;
                if (loadedCount === total) {
                    setTimeout(() => {
                        loadingDiv.style.display = "none";
                        onComplete();
                    }, 500);
                }
            };
            img.onerror = () => {
                loadedCount++;
                if (loadedCount === total) {
                    setTimeout(() => {
                        loadingDiv.style.display = "none";
                        onComplete();
                    }, 500);
                }
            };
        }
    }

    function showPhotosSequentially() {
        let index = 0;
        const interval = setInterval(() => {
            if (index >= photos.length) {
                clearInterval(interval);
                setTimeout(startRomanticFinale, 500);
                return;
            }
            const img = photos[index];
            const photoEl = document.createElement('img');
            photoEl.src = img.src;
            photoEl.className = 'photo';
            photoEl.style.left = `${Math.random() * (window.innerWidth - 120)}px`;
            photoEl.style.top = `${Math.random() * (window.innerHeight - 90)}px`;
            photoEl.style.opacity = "0";
            photoEl.style.transition = "opacity 1s ease";
            photoFlow.appendChild(photoEl);
            requestAnimationFrame(() => { photoEl.style.opacity = "1"; });
            setTimeout(() => {
                photoEl.style.transition = "opacity 1.5s ease";
                photoEl.style.opacity = "0.6";
            }, 1000);
            index++;
        }, 180);
    }

    function startRomanticFinale() {
        const allPhotoEls = [...photoFlow.querySelectorAll('img')];
        const heartPoints = [];
        const dr = (Math.PI * 2) / allPhotoEls.length;
        for (let i = 0; i < Math.PI * 2; i += dr) {
            heartPoints.push(
                scaleAndTranslate(heartPosition(i), CONFIG.heartScale.x, CONFIG.heartScale.y,
                                  window.innerWidth / 2, window.innerHeight / 2)
            );
        }
        let index = 0;
        const steps = 200;
        const leftGroup = [], rightGroup = [];
        allPhotoEls.forEach((img, i) => {
            const target = heartPoints[i];
            (target[0] < window.innerWidth / 2 ? leftGroup : rightGroup).push({ img, target });
        });
        function movePhoto(img, target) {
            const startX = parseFloat(img.style.left);
            const startY = parseFloat(img.style.top);
            const dx = target[0] - startX;
            const dy = target[1] - startY;
            let stepCount = 0;
            function animateMove() {
                stepCount++;
                const progress = stepCount / steps;
                img.style.left = `${startX + dx * progress}px`;
                img.style.top  = `${startY + dy * progress}px`;
                if (stepCount < steps) requestAnimationFrame(animateMove);
            }
            animateMove();
        }
        function flyPair() {
            if (index >= Math.max(leftGroup.length, rightGroup.length)) {
                showCenterTitle();
                startFloatingText();
                return;
            }
            if (index < leftGroup.length) movePhoto(leftGroup[index].img, leftGroup[index].target);
            if (index < rightGroup.length) movePhoto(rightGroup[index].img, rightGroup[index].target);
            index++;
            setTimeout(flyPair, 120);
        }
        flyPair();
    }

    function showCenterTitle() { title.style.opacity = 1; }

    function startFloatingText() {
        setInterval(() => {
            const text = document.createElement("div");
            text.className = "floatingText";
            text.innerHTML = `<span class="cn">ÂñúÊ¨¢ÁõºÁõº</span> <span class="en">Love Panpan</span>`;
            let x = Math.random() * window.innerWidth;
            let y = Math.random() * window.innerHeight;
            const driftX = (rand() - 0.5) * 1.5;
            const driftY = (rand() - 0.5) * 1.5;
            let opacity = 1;
            text.style.left = `${x}px`;
            text.style.top = `${y}px`;
            document.body.appendChild(text);
            function animate() {
                x += driftX; y += driftY; opacity -= 0.004;
                text.style.left = `${x}px`;
                text.style.top = `${y}px`;
                text.style.opacity = opacity;
                if (opacity > 0) requestAnimationFrame(animate);
                else text.remove();
            }
            requestAnimationFrame(animate);
        }, CONFIG.floatingTextInterval);
    }

    function initHeartParticles() {
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        let pointsOrigin = [];
        CONFIG.particleLayers.forEach(layer => {
            for (let i = 0; i < Math.PI * 2; i += 0.1)
                pointsOrigin.push(scaleAndTranslate(heartPosition(i), layer.sx, layer.sy, 0, 0));
        });
        const heartPointsCount = pointsOrigin.length;
        let targetPoints = [], particles = [];
        for (let i = 0; i < heartPointsCount; i++) {
            let x = rand() * canvas.width;
            let y = rand() * canvas.height;
            particles[i] = {
                vx: 0, vy: 0, speed: rand() + 5,
                q: ~~(rand() * heartPointsCount),
                D: 2 * (i % 2) - 1,
                force: 0.2 * rand() + 0.7,
                f: `hsla(0,${~~(40 * rand() + 60)}%,${~~(60 * rand() + 20)}%,.3)`,
                trace: Array.from({length: 50}, () => ({x, y}))
            };
        }
        let timeStep = 0;
        (function loop() {
            const n = -Math.cos(timeStep);
            const kx = (1 + n) * .5, ky = (1 + n) * .5;
            targetPoints = pointsOrigin.map(p => [kx * p[0] + canvas.width / 2, ky * p[1] + canvas.height / 2]);
            timeStep += ((Math.sin(timeStep) < 0) ? 9 : (n > 0.8 ? .2 : 1)) * 0.01;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(u => {
                let q = targetPoints[u.q];
                let dx = u.trace[0].x - q[0];
                let dy = u.trace[0].y - q[1];
                let length = Math.sqrt(dx**2 + dy**2);
                if (length < 10) {
                    if (0.95 < rand()) u.q = ~~(rand() * heartPointsCount);
                    else {
                        if (0.99 < rand()) u.D *= -1;
                        u.q = (u.q + u.D + heartPointsCount) % heartPointsCount;
                    }
                }
                u.vx += -dx / length * u.speed;
                u.vy += -dy / length * u.speed;
                u.trace[0].x += u.vx;
                u.trace[0].y += u.vy;
                u.vx *= u.force;
                u.vy *= u.force;
                for (let k = 0; k < u.trace.length - 1;) {
                    const T = u.trace[k], N = u.trace[++k];
                    N.x -= 0.4 * (N.x - T.x);
                    N.y -= 0.4 * (N.y - T.y);
                }
                ctx.fillStyle = u.f;
                u.trace.forEach(point => {
                    ctx.fillRect(point.x, point.y, 1, 1);
                });
            });
            requestAnimationFrame(loop);
        })();
    }

    function heartExplosion(x, y) {
        let particles = [];
        const colors = ["#ff4d6d", "#ffb6c1", "#ff69b4", "#ff1493", "#db7093"];
        for (let i = 0; i < 30; i++) {
            const elem = document.createElement('div');
            elem.textContent = '‚ù§Ô∏è';
            elem.style.position = 'fixed';
            elem.style.left = `${x}px`;
            elem.style.top = `${y}px`;
            elem.style.fontSize = `${Math.random() * 20 + 14}px`;
            elem.style.pointerEvents = 'none';
            elem.style.zIndex = 1000;
            elem.style.color = colors[Math.floor(Math.random() * colors.length)];
            document.body.appendChild(elem);
            particles.push({
                el: elem,
                angle: rand() * Math.PI * 2,
                speed: rand() * 5 + 2,
                opacity: 1
            });
        }
        function animate() {
            particles.forEach(p => {
                const left = parseFloat(p.el.style.left);
                const top = parseFloat(p.el.style.top);
                p.el.style.left = `${left + Math.cos(p.angle) * p.speed}px`;
                p.el.style.top = `${top + Math.sin(p.angle) * p.speed}px`;
                p.opacity -= 0.02;
                p.el.style.opacity = p.opacity;
                if (p.opacity <= 0) p.el.remove();
            });
            particles = particles.filter(p => p.opacity > 0);
            if (particles.length > 0) requestAnimationFrame(animate);
        }
        animate();
    }

    let started = false;
    playBtn.addEventListener('click', () => {
        if (started) return;
        started = true;
        preloadAllPhotos(CONFIG.totalPhotos, () => {
            music.play().catch(err => console.warn("Êí≠ÊîæÂ§±Ë¥•:", err));
            const rect = playBtn.getBoundingClientRect();
            heartExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2);
            showPhotosSequentially();
        });
        playBtn.classList.add('fadeOut');
        setTimeout(() => playBtn.remove(), 800);
    });

    initHeartParticles();
})();
</script>

</body>
</html>
